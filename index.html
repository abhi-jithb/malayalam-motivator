<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Malayalam Sarcasm Motivator</title>

  <!-- Load Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Noto+Sans+Malayalam:wght@100..900&display=swap');

      body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(to bottom right, #f0f4ff, #e0e7ff);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 20px;
    }

    #app-container {
      max-width: 500px;
      width: 100%;
      background-color: #ffffff;
      box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1),
                  0 4px 6px -2px rgba(0, 0, 0, 0.05);
      border-radius: 1rem;
      padding: 1.5rem;
      margin-top: 5vh;
      animation: fadeIn 0.7s ease-in-out;
    }

    #quote-display {
      min-height: 150px;
      font-family: 'Noto Sans Malayalam', sans-serif;
      font-size: 1.25rem;
      font-weight: 500;
      text-align: center;
      line-height: 1.75;
      color: #1e3a8a;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 0.75rem;
      background-color: #eff6ff;
      padding: 1rem;
      transition: all 0.3s ease-in-out;
    }

    .button-primary {
      background-color: #4f46e5;
      transition: background-color 0.15s ease-in-out, transform 0.05s ease-in-out;
    }

    .button-primary:hover {
      background-color: #4338ca;
      transform: translateY(-1px);
    }

    .button-primary:active {
      transform: translateY(1px);
    }

    #footer {
      text-align: center;
      font-size: 0.875rem;
      color: #6b7280;
      margin-top: 2rem;
    }

    #footer a {
      color: #064279  ;
      font-weight: 600;
      text-decoration: none;
    }

    #footer a:hover {
      text-decoration: underline;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div id="app-container">
    <h1 class="text-3xl font-extrabold text-gray-900 mb-2 text-center">
      ‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç Sarcasm Motivator
    </h1>
    <p class="text-center text-gray-500 mb-6">
      Type what you feel ‚Äî the AI will be sarcastic like your best friend,  
      then heal you like a mother‚Äôs advice ‚ù§Ô∏è
    </p>

    <div class="flex flex-col gap-4 mb-6">
      <textarea
        id="user-input"
        rows="3"
        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm"
        placeholder="‡¥â‡¥¶‡¥æ‡¥π‡¥∞‡¥£‡¥Ç: '‡¥á‡¥®‡µç‡¥®‡µç ‡¥í‡¥∞‡µÅ‡¥™‡¥æ‡¥ü‡µç ‡¥ú‡µã‡¥≤‡¥ø‡¥Ø‡µÅ‡¥£‡µç‡¥ü‡µç, ‡¥§‡µÄ‡¥∞‡¥ø‡¥≤‡µç‡¥≤‡µÜ‡¥®‡µç‡¥®‡µç ‡¥§‡µã‡¥®‡µç‡¥®‡µÅ‡¥®‡µç‡¥®‡µÅ...'"
      ></textarea>

      <button
        id="generate-button"
        class="button-primary text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:shadow-lg flex-shrink-0"
        onclick="generateQuote()"
      >
        Get Roasted üî•
      </button>
    </div>

    <div id="quote-display" class="text-gray-400 italic">
      Type your mood above and click 'Get Roasted!' for your Malayalam-style truth bomb (‡¥∏‡¥§‡µç‡¥Ø‡¥Ç ‡¥Æ‡¥æ‡¥§‡µç‡¥∞‡¥Æ‡µá ‡¥™‡¥±‡¥Ø‡µÇ.üòå).
    </div>

    <p id="error-message" class="text-red-600 text-sm mt-3 hidden text-center"></p>
    <div id="footer">
      <p class="mb-2">
        Made with ‚ù§Ô∏è & sarcasm by 
        <a href="https://github.com/abhi-jthb" target="_blank">@abhijithb</a>
      </p>
      <a
        href="https://github.com/abhi-jithb/malayalam-motivator"
        target="_blank"
        class="inline-block bg-gray-800 text-white px-4 py-2 rounded-lg text-sm hover:bg-black transition"
      >
        ‚≠ê Star this project on GitHub
      </a>
    </div>
  </div>

  <script>

    const userInput = document.getElementById("user-input");
    const generateButton = document.getElementById("generate-button");
    const quoteDisplay = document.getElementById("quote-display");
    const errorMessage = document.getElementById("error-message");

    const sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));

    async function generateQuote() {
      const userFeeling = userInput.value.trim();
      const originalButtonText = generateButton.textContent;

      if (!userFeeling) {
        errorMessage.textContent = "Type something first, ‡¥Æ‡¥ö‡µç‡¥ö‡¥æ‡¥®‡µá üòè";
        errorMessage.classList.remove("hidden");
        return;
      }

      generateButton.disabled = true;
      generateButton.textContent = "Generating... (‡¥í‡¥∞‡µÅ ‡¥®‡¥ø‡¥Æ‡¥ø‡¥∑‡¥Ç. ‡¥á‡¥™‡µç‡¥™‡µä ‡¥∂‡¥∞‡¥ø‡¥Ø‡¥æ‡¥ï‡µç‡¥ï‡¥ø‡¥§‡µç‡¥§‡¥∞‡¥æ‡¥Ç ü™Ñ)";
      quoteDisplay.innerHTML =
        '<svg class="animate-spin h-5 w-5 text-indigo-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';
      quoteDisplay.classList.remove("text-gray-400", "italic");
      errorMessage.classList.add("hidden");
      errorMessage.textContent = "";

      const systemPrompt =
        "You are a sarcastic yet emotional Malayalam movie-style motivator. Speak in **pure Malayalam**. Start with strong, humorous sarcasm ‚Äî like a film dialogue ‚Äî then deliver a punch of real emotional motivation. The output must only be the final quote (no English, no explanation).";
      const userQuery = `User says: "${userFeeling}"`;

      const payload = {
        contents: [{ parts: [{ text: userQuery }] }],
        systemInstruction: { parts: [{ text: systemPrompt }] },
      };

      let resultText = "Failed to generate quote. Try again later.";

      for (let attempt = 0; attempt < 3; attempt++) {
        try {
          const response = await fetch("/api/gemini", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          if (!response.ok) throw new Error("API request failed");
          const result = await response.json();
          const candidate = result.candidates?.[0];

          if (candidate && candidate.content?.parts?.[0]?.text) {
            resultText = candidate.content.parts[0].text.trim();
            break;
          }
        } catch (error) {
          console.error(`Attempt ${attempt + 1} failed:`, error);
          if (attempt < 2) await sleep(1000 * (attempt + 1));
        }
      }

      generateButton.disabled = false;
      generateButton.textContent = originalButtonText;

      if (resultText.startsWith("Failed")) {
        quoteDisplay.innerHTML = `<span class="text-red-500">${resultText}</span>`;
      } else {
        quoteDisplay.textContent = resultText;
      }
    }
  </script>
</body>
</html>
